# Claude + Atlas 协作工作流

本文档定义 Claude 在 Atlas 项目中的协作方式，核心目标是：
**减少无效沟通，避免跑偏设计，保持小步可回滚迭代。**

---

## 1. 协作总模型：三类请求

### A. 明确实现型（直接写代码）

特征：
- 功能、输入、输出、触发方式明确
- 不引入新基础设施
- 不涉及合规灰区

Claude 行为：
- 直接输出可合并代码
- 不提问

示例：
- 新增一个公开 RSS 抓取任务
- 增加字段映射规则
- 日志或目录结构重构

---

### B. 架构 / 边界型（先问再写）

特征：
- 会改变系统形态或成本结构
- 引入新组件或长期依赖

Claude 行为：
- 最多提出 3 个关键问题
- 同时给出默认假设与备选路径

示例：
- 引入数据库 / 搜索引擎
- 使用代理池
- 大规模 LLM 抽取

---

### C. 探索 / 不确定型（先方案后骨架）

特征：
- 目标抽象
- 涉及多模块协作

Claude 行为：
- 先给 1 页方案（模块 + 数据流）
- 同时给最小可运行骨架

示例：
- “做一个更通用的数据管道”
- “设计可扩展的 source 插件系统”

---

## 2. Gate 问题清单（强制）

只要命中以下任一项，Claude 必须先问：

1. 是否需要登录、验证码、付费访问
2. 是否引入新的存储 / 索引系统
3. 是否引入 LLM 且频率未知
4. 是否改变运行形态（服务化 / 云端）
5. 是否破坏本地优先原则

---

## 3. Claude 代码交付清单

每次代码输出，必须包含：

- 目标与范围
- 文件变更列表
- 核心实现
- 运行方式
- 回滚方式
- 最小验证方法

---

## 4. Atlas 推荐迭代里程碑

### Milestone 0：最小闭环
- fetch → normalize → store(raw)
- 无 LLM
- 文件存储

### Milestone 1：结构化与检索
- 规范 schema
- 去重
- 轻量索引

### Milestone 2：智能增强
- LLM 抽取（低频）
- 小模型 / 规则（高频）
- 成本与质量监控

---

## 5. 判定速查表（问 or 写）

| 场景 | Claude 行为 |
|----|----|
| 新增公开 source | 直接写 |
| 新增去重逻辑 | 直接写 |
| 引入 DB / 搜索引擎 | 先问 |
| 使用代理 / 绕反爬 | 先问 |
| LLM 抽取字段 | 先问 |
| 重构目录 / 命名 | 直接写 |
| 做通用插件系统 | 方案 + 骨架 |

---

## 6. 推荐对话模板

### 直接写代码
- 目标：
- 输入：
- 输出：
- 触发方式：
- 约束：

### 允许先问
- 目标：
- 不确定点：
- 可接受默认假设：
- 明确不能做的事：

---

## 7. 核心原则

- 一次只推进一小步
- 所有东西可回滚
- 优先可运行，再优雅
